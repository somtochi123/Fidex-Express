<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fidex Express | Premium Delivery</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://checkout.flutterwave.com/v3.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body {font-family:'Roboto',sans-serif; background:#f5f5f5; margin:0; padding:0;}
.container {max-width:720px; margin:50px auto; background:#fff; border-radius:12px; box-shadow:0 20px 40px rgba(0,0,0,0.08); overflow:hidden;}
.header {background: linear-gradient(90deg,#4b0082,#7b0000); color:#fff; text-align:center; padding:25px;}
.header img {height:60px; margin-bottom:10px;}
.header h1 {margin:0; font-size:24px; letter-spacing:1px; font-weight:700;}
.body {padding:30px;}
.body label {display:block; margin-top:15px; font-weight:500; color:#333;}
.body input, .body select {width:100%; padding:12px; margin-top:6px; border-radius:6px; border:1px solid #ccc; font-size:14px;}
.body button {margin-top:25px; padding:16px; width:100%; background:#7b0000; color:#fff; font-size:16px; font-weight:700; border:none; border-radius:8px; cursor:pointer;}
.body button:hover {background:#550000;}
.success-view {display:none; padding:30px; text-align:center;}
.success-view img {height:80px; margin-bottom:10px;}
.receipt {background:#fdf9f4; border:1px solid #e3dcd1; border-radius:10px; padding:20px; margin-top:20px;}
.receipt h2 {text-align:center; color:#4b0082; font-weight:700;}
.receipt-row {display:flex; justify-content:space-between; margin:10px 0; font-weight:500;}
.status-bar {display:flex; justify-content:space-between; margin-top:25px; position:relative; align-items:center;}
.status-step {flex:1; position:relative; text-align:center; font-size:12px; color:#999;}
.status-step::before {content:""; position:absolute; top:10px; left:50%; transform:translateX(-50%); height:12px; width:12px; border-radius:50%; background:#ccc; z-index:2; transition: background 0.5s;}
.status-step.active::before {background:#4CAF50;} /* green circle */
.status-step:not(:last-child)::after {content:""; position:absolute; top:15px; left:50%; width:100%; height:4px; background:#ccc; z-index:1; transform-origin:left center;}
.status-step-fill {background:#4CAF50; transition: width linear;}
.footer {margin-top:30px; text-align:center; font-size:12px; color:#555;}
.track-container {max-width:400px; margin:30px auto; background:#fff; border-radius:10px; padding:20px; box-shadow:0 15px 30px rgba(0,0,0,0.08);}
.track-container h3 {text-align:center; margin-bottom:15px; color:#4b0082;}
.track-container input {width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px;}
.track-container button {width:100%; padding:12px; background:#7b0000; color:#fff; border:none; border-radius:6px; cursor:pointer; font-weight:700;}
.track-container button:hover {background:#550000;}
.track-history {margin-top:15px; border-top:1px solid #ccc; padding-top:10px;}
.track-history div {margin:5px 0;}
.copy-btn {margin-top:10px; padding:8px 12px; background:#4b0082; color:#fff; border:none; border-radius:5px; cursor:pointer;}
.copy-btn:hover {background:#7b0000;}
</style>
</head>
<body>

<!-- Payment Form -->
<div class="container" id="payment-view">
  <div class="header">
    <img src="https://via.placeholder.com/150x60?text=Fidex+Logo" alt="Fidex Express">
    <h1>Premium Delivery Settlement</h1>
  </div>
  <div class="body">
    <label>Origin Country</label>
    <select id="origin-country" class="country-list"></select>
    <label>Destination Country</label>
    <select id="dest-country" class="country-list"></select>
    <label>Service Level</label>
    <select id="seal-level">
      <option value="">Select Service Level</option>
      <option value="Standard Express">Standard Express</option>
      <option value="Premium Priority">Premium Priority</option>
      <option value="Confidential Handling">Confidential Handling</option>
      <option value="High-Value Secured">High-Value Secured</option>
    </select>
    <label>SENDER NAME</label>
    <input type="text" id="sender-name" placeholder="SENDER NAME">
    <label>RECEIVER NAME</label>
    <input type="text" id="receiver-name" placeholder="YOUR NAME">
    <label>Recipient Email</label>
    <input type="email" id="email" placeholder="client@example.com">
    <label>Amount</label>
    <input type="number" id="amount" placeholder="0.00">
    <label><input type="checkbox" id="terms"> I authorize this delivery</label>
    <button id="pay-btn" onclick="pay()">Confirm & Pay</button>
  </div>
</div>

<!-- Success View -->
<div class="container success-view" id="success-view">
  <div class="header">
    <img src="https://via.placeholder.com/80x80?text=✓" alt="Success">
    <h1>Payment Successful</h1>
  </div>
  <div class="receipt" id="main-card">
    <h2>FIDEX OFFICIAL RECEIPT</h2>
    <div class="receipt-row"><span>Route:</span><span id="rec-route">---</span></div>
    <div class="receipt-row"><span>Tracking ID:</span><span id="rec-track">---</span></div>
    <button class="copy-btn" onclick="copyTracking()">Copy Tracking Code</button>
    <div class="receipt-row"><span>Service Level:</span><span id="rec-level">---</span></div>
    <div class="receipt-row"><span>Transaction Ref:</span><span id="rec-ref">---</span></div>
    <div class="receipt-row"><span>Amount Paid:</span><span id="rec-amt">---</span></div>

    <div class="status-bar">
      <div class="status-step active" id="step1">Received
        <div class="status-step-fill" id="line1"></div>
      </div>
      <div class="status-step" id="step2">In Transit
        <div class="status-step-fill" id="line2"></div>
      </div>
      <div class="status-step" id="step3">Customs
        <div class="status-step-fill" id="line3"></div>
      </div>
      <div class="status-step" id="step4">Out for Delivery
        <div class="status-step-fill" id="line4"></div>
      </div>
      <div class="status-step" id="step5">Delivered</div>
    </div>

    <div class="track-history" id="track-history"></div>
    <div class="footer">
      <p>Authorized by Fidex Express <br> Signature: <em>__________________</em></p>
    </div>
  </div>
  <button id="download-btn" onclick="downloadPDF()">Download Receipt PDF</button>
</div>

<!-- Live Tracking -->
<div class="track-container">
  <h3>Live Package Tracking</h3>
  <input type="text" id="track-input" placeholder="Enter Tracking ID">
  <button onclick="trackShipment()">Track</button>
  <div id="track-result"></div>
</div>

<script>
// Countries list
const countries = ["Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Democratic Republic of the Congo","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Holy See","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Ivory Coast","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea","North Macedonia","Norway","Oman","Pakistan","Palau","Palestine","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Saint Kitts and Nevis","Saint Lucia","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Sweden","Switzerland","Syria","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"];
let shipments=[];

// Load countries
document.addEventListener("DOMContentLoaded",()=>{
  document.querySelectorAll(".country-list").forEach(list=>{
    countries.sort().forEach(c=>{
      const opt=document.createElement("option"); opt.value=c; opt.innerText=c; list.appendChild(opt);
    });
  });
});

// Copy Tracking ID
function copyTracking(){
  const track=document.getElementById("rec-track").innerText;
  navigator.clipboard.writeText(track);
  alert("Tracking code copied: "+track);
}

// Generate Tracking ID
function generateTracking(){return "FDX"+Math.floor(100000+Math.random()*900000);}

// Payment
async function pay(){
  const origin=document.getElementById("origin-country").value;
  const dest=document.getElementById("dest-country").value;
  const level=document.getElementById("seal-level").value;
  const email=document.getElementById("email").value;
  const amountLocal=parseFloat(document.getElementById("amount").value);
  const terms=document.getElementById("terms").checked;
  if(!origin||!dest||!level||!email||!amountLocal||!terms){alert("Fill all fields!");return;}
  const btn=document.getElementById("pay-btn");btn.disabled=true;btn.innerText="Processing Payment...";
  const trackingID=generateTracking();
  FlutterwaveCheckout({
    public_key:"FLWPUBK-b9c6a569af837f1bf82728b00e8d10d1-X",
    tx_ref:"FIDEX-"+Date.now(),
    amount:parseFloat(amountLocal.toFixed(2)),
    currency:"USD",
    payment_options:"card,banktransfer,ussd",
    customer:{email:email},
    callback:function(r){
      if(r.status==="successful"){
        shipments.push({trackingID, origin, dest, level, email, statusHistory:["Received"]});
        document.getElementById("payment-view").style.display="none";
        document.getElementById("success-view").style.display="block";
        document.getElementById("rec-route").innerText=origin+" ➔ "+dest;
        document.getElementById("rec-track").innerText=trackingID;
        document.getElementById("rec-level").innerText=level;
        document.getElementById("rec-ref").innerText=r.transaction_id;
        document.getElementById("rec-amt").innerText="$"+amountLocal.toFixed(2)+" USD";
        simulateTracking(trackingID);
      }
      btn.disabled=false;btn.innerText="Confirm & Pay";
    },
    onclose:function(){btn.disabled=false;btn.innerText="Confirm & Pay";}
  });
}

// Smooth Animated Tracking
function simulateTracking(trackingID){
  const shipment=shipments.find(s=>s.trackingID===trackingID);
  const steps=["In Transit","Customs","Out for Delivery","Delivered"];
  const durations=[5*1000,10*1000,30*60*1000,2*60*60*1000]; //ms
  let i=0;

  function animateLine(lineId,duration,callback){
    const line=document.getElementById(lineId);
    if(!line) return;
    line.style.width='0%';
    line.style.transition=`width ${duration}ms linear`;
    requestAnimationFrame(()=>{line.style.width='100%';});
    setTimeout(callback,duration);
  }

  function nextStep(){
    if(i<steps.length){
      shipment.statusHistory.push(steps[i]);
      updateStatusView(trackingID);
      const lineId='line'+(i+1);
      animateLine(lineId,durations[i],()=>{i++; nextStep();});
    }
  }
  setTimeout(nextStep,5000);
}

// Update Status View
function updateStatusView(trackingID){
  const shipment=shipments.find(s=>s.trackingID===trackingID);
  const stepsDivs=["step1","step2","step3","step4","step5"];
  shipment.statusHistory.forEach((status,index)=>{
    if(stepsDivs[index]){
      const step=document.getElementById(stepsDivs[index]);
      step.classList.add("active");
    }
  });
  let historyHTML="";
  shipment.statusHistory.forEach(s=>{historyHTML+=`<div>${s}</div>`;});
  document.getElementById("track-history").innerHTML=historyHTML;
}

// Download PDF
function downloadPDF(){const element=document.getElementById("main-card");const track=document.getElementById("rec-track").innerText;document.getElementById("download-btn").style.display='none';html2pdf().from(element).save("Fidex_Receipt_"+track+".pdf").then(()=>{document.getElementById("download-btn").style.display='block';});}

// Track manually
function trackShipment(){const id=document.getElementById("track-input").value.trim();const shipment=shipments.find(s=>s.trackingID===id);const res=document.getElementById("track-result");if(!shipment){res.innerText="Tracking ID not found.";return;}let historyHTML="";shipment.statusHistory.forEach(s=>{historyHTML+=`<div>${s}</div>`;});res.innerHTML=historyHTML;}
</script>

</body>
</html>